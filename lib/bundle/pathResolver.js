import path from 'node:path';

/**
 * Resolves the real file system path for a module.
 *
 * @param {string} moduleName
 * @param {string} modulePath
 * @param {boolean} isMinifyOn
 * @returns {string}
 */
export const getModuleRealPath = (moduleName, modulePath, isMinifyOn) => {
    // If minification is on, we expect the map to point to .min.js files
    // or we might need to adjust based on standard Magento behavior.
    // However, Magepack typically relies on the map generated by the browser.
    if (moduleName.startsWith('text!')) {
        return modulePath;
    }

    const extension = path.extname(modulePath);
    if (extension) {
        if (isMinifyOn && extension === '.js') {
            const minifiedPath = modulePath.replace(/\.js$/, '.min.js');
            if (minifiedPath !== modulePath) {
                return minifiedPath;
            }
        }

        return modulePath;
    }

    return isMinifyOn ? `${modulePath}.min.js` : `${modulePath}.js`;
};

/**
 * Generates the target path for the bundle file.
 * Example: pub/static/.../en_US/magepack/bundle-cms.js
 *
 * @param {string} localePath
 * @param {string} bundleName
 * @param {boolean} isMinifyOn
 * @returns {string}
 */
export const getBundlePath = (localePath, bundleName, isMinifyOn) => {
    const filename = `bundle-${bundleName}${isMinifyOn ? '.min' : ''}.js`;
    return path.join(localePath, 'magepack', filename);
};

/**
 * Generates the target path for the bundle configuration file.
 *
 * @param {string} localePath
 * @param {string} bundleName
 * @param {boolean} isMinifyOn
 * @returns {string}
 */
export const getBundleConfigPath = (localePath, bundleName, isMinifyOn) => {
    const filename = `requirejs-config-${bundleName}${isMinifyOn ? '.min' : ''}.js`;
    return path.join(localePath, 'magepack', filename);
};

// Export object for backward compatibility if needed, but named exports are preferred
export default {
    getModuleRealPath,
    getBundlePath,
    getBundleConfigPath,
};
